<div class="col-md-6 col-lg-4 stream-card-container" data-stream-name="{{ stream.name }}">
  <div class="card stream-card">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h5>{{ stream.original_name }}</h5>
      <span class="badge bg-{% if stream.online %}success{% else %}danger{% endif %} stream-status">
        {% if stream.online %}Online{% else %}Offline{% endif %}
      </span>
    </div>

    <div class="video-container">
      {% if stream.online %}
      <div class="mistvideo" id="{{ stream.name }}_{{ stream.embed_id }}">
        <noscript>
          <a href="http://tir3.com/{{ stream.name }}.html" target="_blank">
            Click here to play this video
          </a>
        </noscript>
      </div>
      {% else %}
      <div class="offline-placeholder">
        <h4>Stream Offline</h4>
      </div>
      {% endif %}
    </div>

    <div class="card-body">
      <div class="row">
        <div class="col-6">
          <p>
            <strong>Viewers:</strong>
            <span class="stream-viewers">{{ stream.current_viewers }}</span>
          </p>
        </div>
      </div>

      {% if stream.push_count > 0 %}
      <div class="mt-2 push-status-section">
        <div class="push-status-container">
          {% for push in stream.push_configs %}
          <div class="push-config {% if push.deactivated %}push-inactive{% else %}push-active{% endif %}">
            <div class="d-flex justify-content-between">
              <div>
                <strong>Status:</strong>
                <span class="badge bg-{% if push.deactivated %}danger{% else %}success{% endif %}">
                  {% if push.deactivated %}INACTIVE{% else %}ACTIVE{% endif %}
                </span>
              </div>
              <div class="text-end">
                <div><strong>Target:</strong></div>
                <div class="push-target">
                  {{ push.target|truncate(20, True, '...') }}
                </div>
              </div>
            </div>
            {% if push.notes %}
            <div class="push-notes mt-1">
              <strong>Notes:</strong> {{ push.notes }}
            </div>
            {% endif %}
            <div class="push-controls mt-2">
              <div class="input-group input-group-sm mb-2">
                <input
                  type="text"
                  class="form-control push-url-input"
                  value="{{ push.target }}"
                />
                <button
                  class="btn btn-outline-primary update-url-btn"
                  data-push-id="{{ push.push_id }}"
                >
                  Update
                </button>
              </div>
              <div class="text-end">
                <button
                  class="btn btn-sm btn-{% if push.deactivated %}success{% else %}warning{% endif %} toggle-push"
                  data-push-id="{{ push.push_id }}"
                  data-current-state="{% if push.deactivated %}inactive{% else %}active{% endif %}"
                >
                  {% if push.deactivated %}Activate{% else %}Deactivate{% endif %}
                </button>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
      {% endif %}

      <div class="d-flex justify-content-between mt-2">
        <div>
          <a href="/stream/{{ stream.name }}" class="btn btn-sm btn-primary">Details</a>
          <button
            class="btn btn-sm btn-danger ms-2 reset-stream-btn"
            data-stream-name="{{ stream.name }}"
          >
            Reset Stream
          </button>
          <button
            class="btn btn-sm btn-info ms-2 share-stream-btn"
            data-stream-name="{{ stream.name }}"
            data-stream-url="http://tir3.com/{{ stream.name }}.html"
          >
            <i class="bi bi-share"></i> Share
          </button>
        </div>
        <span class="text-muted small">Updated: {{ stream.last_updated }}</span>
      </div>
    </div>
  </div>
</div>